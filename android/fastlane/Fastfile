require 'dotenv'

# âœ… ØªØ­Ù…ÙŠÙ„ Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø© Ù…Ù† .env ÙÙŠ Ø¬Ø°Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
env_path = File.expand_path("../../../.env", __FILE__)
Dotenv.load(env_path) if File.exist?(env_path)

default_platform(:android)

platform :android do
  desc "ğŸš€ Distribute APK to Firebase with Fastlane"

  lane :firebase_distribution do
    # ğŸ§¹ ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ù†Ø§Ø¡
    sh "flutter clean"

    # ğŸ—ï¸ Ø¨Ù†Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ù„Ø¥ØµØ¯Ø§Ø± Ø¨ØµÙŠØºØ© APK
    sh "flutter build apk --release --no-tree-shake-icons"

    # ğŸš€ ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù†Ø³Ø®Ø© Ø¹Ø¨Ø± Firebase App Distribution
    firebase_app_distribution(
      app: ENV["FIREBASE_APP_ID"],
      firebase_cli_token: ENV["FIREBASE_CLI_TOKEN"],
      android_artifact_type: "APK",
      android_artifact_path: "../build/app/outputs/flutter-apk/app-release.apk",
      testers: ENV["FIREBASE_TESTERS"],
      release_notes: ENV["FIREBASE_RELEASE_NOTES"]
    )
  end
end